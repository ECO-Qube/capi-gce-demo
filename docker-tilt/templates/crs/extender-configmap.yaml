apiVersion: v1
data:
  extender.yaml: "---\napiVersion: v1\nkind: Service\nmetadata:\n  name: tas-service\n
    \ namespace: default\nspec:\n  selector:\n    app: tas\n  type: ClusterIP\n  ports:\n
    \   - port: 9001\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name:
    telemetry-aware-scheduling\n  namespace: default\n  labels:\n    app: tas\nspec:\n
    \ replicas: 1\n  selector:\n    matchLabels:\n      app: tas\n  template:\n    metadata:\n
    \     labels:\n        app: tas\n    spec:\n      serviceAccountName: telemetry-aware-scheduling-service-account\n
    \     containers:\n        - name: tasext\n          command:\n            - /extender\n
    \           - --syncPeriod=2s\n            - --cert=/tas/cert/tls.crt\n            -
    --key=/tas/cert/tls.key\n            - --cacert=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n
    \           - --v=2\n          image: intel/telemetry-aware-scheduling\n          imagePullPolicy:
    IfNotPresent\n          securityContext:\n            capabilities:\n              drop:\n
    \               - all\n            readOnlyRootFilesystem: true\n            runAsNonRoot:
    true\n            runAsUser: 10001\n          volumeMounts:\n            - name:
    certs\n              mountPath: /tas/cert\n          resources:\n            limits:\n
    \             memory: \"500Mi\"\n              cpu: \"500m\"\n            requests:\n
    \             memory: \"100Mi\"\n              cpu: \"100m\"\n      volumes:\n
    \       - name: certs\n          secret:\n            secretName: extender-secret\n
    \     tolerations:\n        - key: node-role.kubernetes.io/master\n          operator:
    Exists\n        - key: \"node-role.kubernetes.io/control-plane\"\n          operator:
    \"Exists\"\n          effect: \"NoSchedule\"\n      affinity:\n        nodeAffinity:\n
    \         requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n
    \             - matchExpressions:\n                  - key: node-role.kubernetes.io/control-plane\n
    \                   operator: Exists\n---\napiVersion: apiextensions.k8s.io/v1\nkind:
    CustomResourceDefinition\nmetadata:\n  name: taspolicies.telemetry.intel.com\n
    \ namespace: default\nspec:\n  group: telemetry.intel.com\n  names:\n    kind:
    TASPolicy\n    listKind: TASPolicyList\n    plural: taspolicies\n    singular:
    taspolicy\n  scope: Namespaced\n  versions:\n    - name: v1alpha1\n      served:
    true\n      storage: true\n      schema:\n        openAPIV3Schema:\n          type:
    object\n          properties:\n           apiVersion:\n             description:
    'APIVersion defines the versioned schema of this representation of an object.
    Servers should convert recognized schemas to the latest'\n             type: string\n
    \          kind:\n             description: 'Kind is a string value representing
    the REST resource this object represents. Servers may infer this from the endpoint
    the client'\n             type: string\n           metadata:\n             type:
    object\n           spec:\n             properties:\n               strategies:\n
    \                additionalProperties:\n                   properties:\n                     policyName:\n
    \                      type: string\n                     logicalOperator:\n                       type:
    string\n                       enum: [\"allOf\", \"anyOf\"]\n                     rules:\n
    \                      items:\n                         description: Set rules
    parameters per strategy\n                         properties:\n                           metricname:\n
    \                            type: string\n                           operator:\n
    \                            type: string\n                             enum:
    [\"Equals\",\"LessThan\",\"GreaterThan\"]\n                           target:\n
    \                            format: float\n                             type:
    number\n                           labels:\n                             type:
    array\n                             items:\n                               type:
    string\n                         required:\n                           - metricname\n
    \                          - operator\n                         type: object\n
    \                      type: array\n                   required:\n                     -
    rules\n                   type: object\n                 type: object\n             required:\n
    \              - strategies\n             type: object\n           status:\n             properties:\n
    \              compliance:\n                 type: string\n               message:\n
    \                type: string\n             type: object\n      subresources:\n
    \       status: {}\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n
    \ name: policy-handler\n  namespace: default\nrules:\n- apiGroups: [\"telemetry.intel.com\"]\n
    \ resources: [\"taspolicies\"]\n  verbs: [\"get\", \"watch\", \"list\", \"delete\",
    \"update\"]\n- apiGroups: [\"custom.metrics.k8s.io\"]\n  resources: [\"*\"]\n
    \ verbs: [\"get\"]\n- apiGroups: [\"\"]\n  resources: [\"pods\"]\n  verbs: [\"get\",\"list\",\"watch\",\"update\"]\n-
    apiGroups: [\"\"]\n  resources: [\"nodes\"]\n  verbs: [\"get\", \"list\", \"patch\"]\n---\napiVersion:
    rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: handle-policies\n
    \ namespace: default\nsubjects:\n  - kind: ServiceAccount\n    name: telemetry-aware-scheduling-service-account\n
    \   namespace: default\nroleRef:\n  kind: ClusterRole\n  name: policy-handler\n
    \ apiGroup: rbac.authorization.k8s.io\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n
    \ name: telemetry-aware-scheduling-service-account\n  namespace: default\n---\napiVersion:
    v1\nkind: ConfigMap\nmetadata:\n  name: scheduler-extender-policy\n  namespace:
    kube-system\ndata:\n  policy.cfg: |\n    {\n        \"kind\" : \"Policy\",\n        \"apiVersion\"
    : \"v1\",\n        \"extenders\" : [\n            {\n              \"urlPrefix\":
    \"https://tas-service.default.svc.cluster.local:9001\",             \n              \"apiVersion\":
    \"v1\",\n              \"prioritizeVerb\": \"scheduler/prioritize\",\n              \"filterVerb\":
    \"scheduler/filter\",\n              \"weight\": 1,\n              \"enableHttps\":
    true,\n              \"managedResources\": [\n                   {\n                     \"name\":
    \"telemetry/scheduling\",\n                     \"ignoredByScheduler\": true\n
    \                  }\n              ],\n              \"ignorable\": true,\n              \"tlsConfig\":
    {\n                     \"insecure\": false,\n                     \"certFile\":
    \"/host/certs/client.crt\",\n                     \"keyFile\" : \"/host/certs/client.key\"\n
    \             }\n            }\n           ]\n    }\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind:
    ClusterRole\nmetadata:\n  name: configmapgetter\nrules:\n- apiGroups: [\"\"]\n
    \ resources: [\"configmaps\"]\n  verbs: [\"get\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind:
    ClusterRoleBinding\nmetadata:\n  name: scheduler-config-map\nroleRef:\n  apiGroup:
    rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: configmapgetter\nsubjects:\n-
    apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: system:kube-scheduler\n---\napiVersion:
    v1\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNsakNDQVg0Q0NRRDZkSC9pQ0ZYYzZUQU5CZ2txaGtpRzl3MEJBUXNGQURBTk1Rc3dDUVlEVlFRRERBSmoKWVRBZUZ3MHlNakEyTURreE1qUTJNakJhRncweU16QTJNRGt4TWpRMk1qQmFNQTB4Q3pBSkJnTlZCQU1NQW1OaApNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXZLTHZ4R1hQVkNndFlFckJ4dHp1Cmk5M2JLTURDa25nRFVLMUpwRkRKb1FuRlFnV3REZGU3Q0ZmaXVXT3d0SmR5eWN4dVZXRlJBMEducGhaRUc3S0gKdmVwcnh6dWtjVEhUNHA5bXVUM2QzTTlKY1dQbUdueHd0NXU0Qkt1d3pySk1CbDk1L2g4NnBLL1ZDRDh0U1BHUAovaitBUUF2YzBzWFJYZEc2czJFN05KV0dIRElQVFpEQ01JVTVTMmhKRTIzUlQ5V2F6dVZ4aVJTQThRLzZMNml0CmRDdDZ2QUxqcUhCOTliRUFmQmlsMDFsb1UvYjVuZDVLZTJ6cXo0b2h1NW9pUFZlZjVUck9RT0p4RUZCb1llK08KZEFJT3U1YmdtV2VTWnJVeTRqbldaeWU2TUtacHVIeDhPZzFPTSthUTFwT3JTZUxOcS9HNVdPR0hWUlNKVlBpbApkUUlEQVFBQk1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQjY1U29PZ3ZTVml0L1RpSFdSMUF6Y25BYklpV1hiCnl1dGxuQmh5UjdzaUwvZzEvUThUSnZVRngrbEtja1ROMGg1R3lzRHZjVkVhM2VVdWQvUUd6eGVnTEVlL1J4aEkKY3NPNGlQMDFINGl0UlVWRjB6bEZXMFdoLy80aXpEMmJjSG5HaUNnaXFZcXlzZEFvMnFBQUdid09IS0EraGtWcgo4TEM0ZW5EMS84OGFONFJiaG9XS0xMMUJEUXpvZXZMaGRDRlB4a3Rtdm5PY3F5Zm01L3BaNTFMYk81cDBWOVhtCjVrekdzaUg4Q1I2Vlc0bFhiUFZjN2tRTCs1OXJGYlV3Wml5U3VVRS9ITjdCWDNsbmtVeVM5cHNWQkZwU3dFdVcKd3RsQ2dLbzVmMW5OR3RjdU1ZUG8vaytxRXRLMHhqTS9NUTRtT3dLQ0VSc1JETEhwMFlSSDJkSlMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\n
    \ tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV3QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktvd2dnU21BZ0VBQW9JQkFRQzhvdS9FWmM5VUtDMWcKU3NIRzNPNkwzZHNvd01LU2VBTlFyVW1rVU1taENjVkNCYTBOMTdzSVYrSzVZN0MwbDNMSnpHNVZZVkVEUWFlbQpGa1Fic29lOTZtdkhPNlJ4TWRQaW4yYTVQZDNjejBseFkrWWFmSEMzbTdnRXE3RE9za3dHWDNuK0h6cWtyOVVJClB5MUk4WS8rUDRCQUM5elN4ZEZkMGJxellUczBsWVljTWc5TmtNSXdoVGxMYUVrVGJkRlAxWnJPNVhHSkZJRHgKRC9vdnFLMTBLM3E4QXVPb2NIMzFzUUI4R0tYVFdXaFQ5dm1kM2twN2JPclBpaUc3bWlJOVY1L2xPczVBNG5FUQpVR2hoNzQ1MEFnNjdsdUNaWjVKbXRUTGlPZFpuSjdvd3BtbTRmSHc2RFU0ejVwRFdrNnRKNHMycjhibFk0WWRWCkZJbFUrS1YxQWdNQkFBRUNnZ0VCQUo5NUxEU2dVYWYzRTIxOXBkYW1QckZXRFFxbDg1aDZCMnQwSkhiYXFhc1EKSklpTlhlRC9DYXFqQ2hUcTk1K2xEYkVXdUF4TWFuM1RTcFU1NjdoeXRSbFVqbXR2dTdUS2lEUGx5S1ZBYlVsWQpvT0ZRc0Y2aDUzVUNHNDh2U3hsaldLeG1tUzdDWGdTT2RnNHp3dWdRK0VmY2pXTVg1RWI0WCtqdC91WFpoSUVOCmwzemVWQ0kyZDBEbkRUa2swbG0va0EwUmthOWxxMWVLL3VNN1hkQjdhYUhKWENISG8va1JaSmk1YXE0WWtmQ0IKWk5uYUZhUmgxbUszK2xaMEJxcER0aXlDYWNHazBQekphTXN3QU92NVZDTjhoY1NSbTJZVE1TY3gzcmpBQW9uNQorVnpjUGF0b000ZVRzRkVRYjZoeTB4L2cwbVJjdmQ3czBpRUZRREp5QVVFQ2dZRUE2ZFI4MTV4ZzBjVm1yNE91CkZPcEZmMTliRkZsMWlLSFZmTU9aN0o5R3MrVSt6NzMwdTN3alkrazd3T1pIdGZqMVhGL1I3UEpUdk5GdHVyOXkKYzBoWDhDdnJwWjZUM1ViS0grdzVsNk9MZDVhM2xCbVhCek9tT0crTDI5YmJJKysxNy9PeU5RaDFFTE43WVVzUApONHlseWlaaGF1VHpKVG90QjIvQk1SZHZNQ1VDZ1lFQXpvV0RTSmRzMGxQdysrRGhtdk50Qk5mU0ZkTU9lQU9FCmYydHh1NHFMd3lhV3FYUC84Z0lOMXRDZUdMY0x1VUcwUWQ2U1lmTHF0UjdvZ0M5eUdHTmhkeG9zeW5DQWpSVkYKWkYrYU5XdWMrTmRUME9FSkU1Z3I4MDgvTzREVVZaTmZpR0h3Ty8xYW9HMVNqak1BY0x2ZFN6TVRxbXJyc3JSbwpJcysrK0RDOHR4RUNnWUVBeDQyYUJYL2xlT0NZbzgwak1hSkZNVkMxc0FZd3NpdzZ2OEZHaVpQY2lRWnB0bTBNCmdUeU9EMlFxcEpOaU84QjkxUm5KVkFmeXdyK1FmOEdHOFMrYUxOT3V4YWN4MWJQbUo1dzRBbHVHV01iOVlKeisKTVIwNURBeldOUVdGKzRORnA4UTRIOTVaMmFqeThMTllCelkyL3ZBR1QyMll1L3FNRno2ZWgwRFNtU2tDZ1lFQQp1SzFoMmM4M1M5b3VmRDc3MytGZ2t0MGdDODRoZVNiRUhHR0xZY2FoOXBBU1dGUFlBNlRjbFVVV3EwazhuWnhvCndpSnpTazI4bnR5VjB0TWF0ejVma084Q01NRnI0ejJyUVBmUTRZWnE1NGMrZDJKVkNJV2lmOEJVN2pQbExPVk4KbjVyZEJmZ29TNStYSEh2MUg5cVBLRWp6aEFoNjN1SSs0U3BmUG5mdXVkRUNnWUVBblRoYTFRakpoMHM1dkJ2cQp5UVgwWThvbXFkR1QxZldLTncwQTR2MUQ2T2taYk5XRkUzRVVLRUNCUzhEaUc3Q3d6L3NHT20rc2szQU9HVURZCkE4MTd0RFZ3a2VoNEhoRFB5a1dRRVpINXBNUmNWUm5aaU1wUktmUjhGQW42U3NTdzRvWCs5Vkl5RmxBaHFPYSsKeEk2ZWJ3N2NmR01XYTRIYWZLLzluVTgxempvPQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==\nkind:
    Secret\nmetadata:\n  name: extender-secret\n  namespace: default\ntype: kubernetes.io/tls"
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: extender-configmap
